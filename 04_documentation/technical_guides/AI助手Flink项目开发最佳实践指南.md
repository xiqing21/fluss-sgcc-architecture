# ðŸ¤– AIåŠ©æ‰‹ + Flinké¡¹ç›®å¼€å‘æœ€ä½³å®žè·µæŒ‡å—

> **é€‚ç”¨åœºæ™¯**ï¼šAIåŠ©æ‰‹ååŠ©è¿›è¡ŒFlinkã€Flussã€CDCç­‰æµå¤„ç†é¡¹ç›®å¼€å‘  
> **ç›®æ ‡**ï¼šé¿å…å¸¸è§å‘ç‚¹ï¼Œä¼˜åŒ–å¼€å‘å·¥ä½œæµï¼Œæé«˜å¼€å‘æ•ˆçŽ‡  
> **å¤ç”¨æ€§**ï¼šå¯ç›´æŽ¥åº”ç”¨äºŽå…¶ä»–ç±»ä¼¼é¡¹ç›®æˆ–å¹³å°

---

## ðŸ“‹ **æ ¸å¿ƒåŽŸåˆ™**

### ðŸ”´ **åŽŸåˆ™1ï¼šé¡¹ç›®æ–‡ä»¶è¾¹ç•Œä¸¥æ ¼æŽ§åˆ¶**
```bash
# âœ… æ­£ç¡®ï¼šæ‰€æœ‰æ–‡ä»¶éƒ½åœ¨é¡¹ç›®å†…
project-root/
â”œâ”€â”€ docs/           # æ–‡æ¡£
â”œâ”€â”€ scripts/        # è„šæœ¬
â”œâ”€â”€ sql/           # SQLæ–‡ä»¶
â””â”€â”€ config/        # é…ç½®æ–‡ä»¶

# âŒ é”™è¯¯ï¼šåœ¨é¡¹ç›®å¤–åˆ›å»ºæ–‡ä»¶
../some-file.md     # ä¼šå¯¼è‡´æ‰¾ä¸åˆ°æ–‡ä»¶
/tmp/temp-file.sql  # ä¸ä¾¿äºŽç‰ˆæœ¬æŽ§åˆ¶
```

**AIåŠ©æ‰‹æ‰§è¡Œè§„åˆ™ï¼š**
- ðŸš« **ç¦æ­¢**åœ¨é¡¹ç›®æ ¹ç›®å½•ä¹‹å¤–åˆ›å»ºä»»ä½•æ–‡ä»¶
- âœ… **å¿…é¡»**å§‹ç»ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„åœ¨é¡¹ç›®å†…åˆ›å»ºæ–‡ä»¶
- ðŸ” **éªŒè¯**æ¯æ¬¡æ“ä½œå‰ç¡®è®¤å½“å‰å·¥ä½œç›®å½•

### ðŸ”´ **åŽŸåˆ™2ï¼šDockeré…ç½®ç²¾å‡†æŽ§åˆ¶**
```yaml
# âœ… æ­£ç¡®ï¼šç²¾å‡†æŒ‚è½½è¿žæŽ¥å™¨åˆ°å­ç›®å½•
volumes:
  - ./external-jars:/opt/flink/lib/connectors

# âŒ é”™è¯¯ï¼šè¦†ç›–æ•´ä¸ªlibç›®å½•å¯¼è‡´å®¹å™¨æ— æ³•å¯åŠ¨
volumes:
  - ./external-jars:/opt/flink/lib  # ä¼šè¦†ç›–Flinkæ ¸å¿ƒJARåŒ…
```

**å…³é”®è¦ç‚¹ï¼š**
- Dockerå®¹å™¨çš„`/opt/flink/lib`åŒ…å«Flinkæ ¸å¿ƒJARåŒ…
- å¤–éƒ¨è¿žæŽ¥å™¨åº”æŒ‚è½½åˆ°å­ç›®å½•ï¼Œé¿å…è¦†ç›–
- ä¿®æ”¹Dockeré…ç½®åŽå¿…é¡»å®Œå…¨é‡å¯å®¹å™¨ç¾¤

### ðŸ”´ **åŽŸåˆ™3ï¼šèªæ˜Žçš„æµ‹è¯•ç­–ç•¥**
```sql
-- âœ… é«˜æ•ˆï¼šä½¿ç”¨COUNTå’ŒLIMIT
SELECT COUNT(*) as total FROM large_table;
SELECT * FROM large_table ORDER BY event_time DESC LIMIT 5;

-- âŒ ä½Žæ•ˆï¼šå…¨è¡¨æ‰«ææ¶ˆè€—å¤§é‡token
SELECT * FROM large_table;  -- å¯èƒ½è¿”å›žç™¾ä¸‡è¡Œæ•°æ®
```

---

## ðŸ› ï¸ **æŠ€æœ¯å±‚é¢æœ€ä½³å®žè·µ**

### ðŸ“¦ **è¿žæŽ¥å™¨ç®¡ç†**

#### JARåŒ…ç®¡ç†ç­–ç•¥
```bash
# 1. åˆ›å»ºä¸“ç”¨è¿žæŽ¥å™¨ç›®å½•
mkdir -p external-jars/

# 2. ç²¾å‡†DockeræŒ‚è½½é…ç½®
cat >> docker-compose.yml << 'EOF'
    volumes:
      - ./external-jars:/opt/flink/lib/connectors  # å­ç›®å½•æŒ‚è½½
EOF

# 3. éªŒè¯è¿žæŽ¥å™¨åŠ è½½
docker exec container-name ls -la /opt/flink/lib/connectors/
```

#### å¸¸ç”¨è¿žæŽ¥å™¨æ¸…å•
```bash
# PostgreSQLç›¸å…³
flink-connector-jdbc-3.2.0-1.18.jar
flink-sql-connector-postgres-cdc-3.1.1.jar  
postgresql-42.7.1.jar

# Kafkaç›¸å…³
flink-sql-connector-kafka-3.2.0-1.18.jar

# å…¶ä»–æ•°æ®æº
flink-connector-elasticsearch7-3.0.1-1.18.jar
```

### ðŸ—„ï¸ **SQLè¯­æ³•æœ€ä½³å®žè·µ**

#### ä¿ç•™å­—å¤„ç†
```sql
-- âœ… æ­£ç¡®ï¼šä½¿ç”¨åå¼•å·å¤„ç†ä¿ç•™å­—
CREATE TABLE device_data (
    device_id STRING,
    `current` DOUBLE,  -- currentæ˜¯ä¿ç•™å­—ï¼Œéœ€è¦åå¼•å·
    `timestamp` TIMESTAMP(3),  -- timestampæ˜¯ä¿ç•™å­—
    `order` INT  -- orderæ˜¯ä¿ç•™å­—
);
```

#### CONCATå‡½æ•°ç±»åž‹è½¬æ¢
```sql
-- âœ… æ­£ç¡®ï¼šæ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºSTRING
CONCAT('RPT_', location, '_', CAST(DATE_FORMAT(time, 'yyyyMMddHH') AS STRING))

-- âŒ é”™è¯¯ï¼šç±»åž‹ä¸åŒ¹é…
CONCAT('RPT_', location, '_', DATE_FORMAT(time, 'yyyyMMddHH'))  -- ç±»åž‹é”™è¯¯
```

#### è·¨CatalogæŸ¥è¯¢
```sql
-- âœ… æ­£ç¡®ï¼šä½¿ç”¨å®Œæ•´è·¯å¾„
INSERT INTO fluss_catalog.database.target_table 
SELECT * FROM default_catalog.default_database.source_table;

-- âŒ é”™è¯¯ï¼šè·¯å¾„ä¸å®Œæ•´
INSERT INTO target_table SELECT * FROM source_table;  -- æ‰¾ä¸åˆ°è¡¨
```

### ðŸ”„ **CDCé…ç½®æœ€ä½³å®žè·µ**

#### PostgreSQL CDCå¿…å¤‡é…ç½®
```sql
CREATE TABLE cdc_source (...) WITH (
    'connector' = 'postgres-cdc',
    'hostname' = 'postgres-host',
    'port' = '5432',
    'username' = 'user',
    'password' = 'pass',
    'database-name' = 'dbname',
    'schema-name' = 'schema',
    'table-name' = 'table',
    'slot.name' = 'unique_slot_name',  -- å¿…é¡»å”¯ä¸€
    'decoding.plugin.name' = 'pgoutput'  -- ä½¿ç”¨å†…ç½®è§£ç å™¨ï¼Œé¿å…æ’ä»¶ä¾èµ–
);
```

---

## ðŸš« **ä¸¥ç¦æ“ä½œæ¸…å•**

### âŒ **æ–‡ä»¶æ“ä½œç¦å¿Œ**
1. **åœ¨é¡¹ç›®æ ¹ç›®å½•å¤–åˆ›å»ºæ–‡ä»¶**
   - `../config.yml` âŒ  
   - `/tmp/test.sql` âŒ
   - `~/.local/script.sh` âŒ

2. **è¦†ç›–å…³é”®ç³»ç»Ÿç›®å½•**
   - `-v ./jars:/opt/flink/lib` âŒ (ä¼šè¦†ç›–Flinkæ ¸å¿ƒJAR)
   - `-v ./config:/opt/flink/conf` âŒ (ä¼šè¦†ç›–Flinké…ç½®)

### âŒ **SQLæ“ä½œç¦å¿Œ**
1. **ä¿ç•™å­—æœªå¤„ç†**
   ```sql
   CREATE TABLE test (current DOUBLE);  âŒ
   CREATE TABLE test (`current` DOUBLE); âœ…
   ```

2. **ç±»åž‹è½¬æ¢ç¼ºå¤±**
   ```sql
   CONCAT('ID_', some_number)  âŒ
   CONCAT('ID_', CAST(some_number AS STRING))  âœ…
   ```

### âš ï¸ **ç‰ˆæœ¬å…¼å®¹æ€§ç¦å¿Œ**
1. **ä½¿ç”¨è¿‡æ—¶çš„JARåŒ…**
   ```bash
   # âŒ é”™è¯¯ï¼šæ—§ç‰ˆæœ¬JDBCè¿žæŽ¥å™¨
   flink-connector-jdbc_2.11-1.14.4.jar
   
   # âœ… æ­£ç¡®ï¼šFlink 1.20å…¼å®¹ç‰ˆæœ¬
   flink-connector-jdbc-3.3.0-1.20.jar
   ```

2. **å¿½ç•¥å®‰å…¨æ¼æ´ž**
   ```bash
   # âŒ é”™è¯¯ï¼šå­˜åœ¨å®‰å…¨æ¼æ´žçš„é©±åŠ¨
   postgresql-42.6.x.jar
   
   # âœ… æ­£ç¡®ï¼šæœ€æ–°å®‰å…¨ç‰ˆæœ¬
   postgresql-42.7.7.jar
   ```

---

## âœ… **å¿«é€Ÿæ£€æŸ¥æ¸…å•**

### ðŸ”§ **é¡¹ç›®å¯åŠ¨å‰æ£€æŸ¥**
- [ ] Docker Composeé…ç½®æ­£ç¡®ï¼ˆJARæŒ‚è½½åˆ°å­ç›®å½•ï¼‰
- [ ] æ‰€æœ‰å¿…éœ€çš„JARåŒ…å·²æ”¾ç½®åˆ°fluss/jars/
- [ ] PostgreSQL WALé…ç½®æ­£ç¡®ï¼ˆlogical levelï¼‰
- [ ] ç½‘ç»œå’Œç«¯å£é…ç½®æ— å†²çª
- [ ] æ–‡ä»¶ç›®å½•ç»“æž„æ¸…æ™°å®Œæ•´
- [ ] **å…³é”®ï¼šéªŒè¯JARåŒ…ç‰ˆæœ¬å…¼å®¹æ€§**
  - [ ] `flink-connector-jdbc-3.3.0-1.20.jar` (440KB)
  - [ ] `postgresql-42.7.7.jar` (1.1MB)

### ðŸ§ª **æµ‹è¯•æ‰§è¡Œå‰æ£€æŸ¥**  
- [ ] ç¡®è®¤å½“å‰å·¥ä½œç›®å½•åœ¨é¡¹ç›®æ ¹ç›®å½•
- [ ] æ‰€æœ‰SQLè¯­å¥ä¿ç•™å­—å·²ç”¨åå¼•å·å¤„ç†
- [ ] CONCATå‡½æ•°å‚æ•°å·²è¿›è¡Œç±»åž‹è½¬æ¢
- [ ] è·¨CatalogæŸ¥è¯¢ä½¿ç”¨å®Œæ•´è·¯å¾„
- [ ] æµå¼æŸ¥è¯¢ä½¿ç”¨timeouté¿å…å¡ä½
- [ ] **å…³é”®ï¼šéªŒè¯è¿žæŽ¥å™¨åŠ è½½çŠ¶æ€**
  - [ ] æ£€æŸ¥TaskManageræ—¥å¿—æ— JARåŒ…é”™è¯¯
  - [ ] éªŒè¯JdbcDynamicTableFactoryå¯ç”¨

### ðŸ” **é—®é¢˜è¯Šæ–­æ£€æŸ¥**
- [ ] æŸ¥çœ‹çŸ¥è¯†åº“æ˜¯å¦æœ‰ç›¸åŒé—®é¢˜
- [ ] æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ
- [ ] éªŒè¯çŽ¯å¢ƒé…ç½®æ˜¯å¦æ­£ç¡®
- [ ] ç¡®è®¤æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ

---

## ðŸŽ¯ **AIåŠ©æ‰‹æç¤ºè¯æ¨¡æ¿**

### é€šç”¨å·¥ä½œæç¤ºè¯
```
åœ¨æŽ¥ä¸‹æ¥çš„Flinké¡¹ç›®å¼€å‘ä¸­ï¼Œè¯·ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

1. æ–‡ä»¶æ“ä½œè§„åˆ™ï¼š
   - æ‰€æœ‰æ–‡ä»¶å¿…é¡»åˆ›å»ºåœ¨é¡¹ç›®æ ¹ç›®å½•å†…
   - ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç¦æ­¢ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–../å‘ä¸Šè·¯å¾„  
   - æ¯æ¬¡æ“ä½œå‰ç”¨pwdç¡®è®¤å·¥ä½œç›®å½•

2. Dockeré…ç½®è§„åˆ™ï¼š
   - JARåŒ…æŒ‚è½½åˆ°/opt/flink/lib/jarsï¼Œä¸è¦è¦†ç›–/opt/flink/lib
   - ä¿®æ”¹docker-compose.ymlåŽå¿…é¡»å®Œå…¨é‡å¯å®¹å™¨ç¾¤

3. ç‰ˆæœ¬å…¼å®¹æ€§è§„åˆ™ï¼ˆâš ï¸ æžå…¶é‡è¦ï¼‰ï¼š
   - Flink 1.20å¿…é¡»ä½¿ç”¨flink-connector-jdbc-3.3.0-1.20.jar
   - ä½¿ç”¨æœ€æ–°å®‰å…¨çš„PostgreSQLé©±åŠ¨42.7.7
   - é‡åˆ°JdbcFactoryé”™è¯¯ç«‹å³æ£€æŸ¥JARåŒ…ç‰ˆæœ¬
   - å‚è€ƒçŸ¥è¯†åº“çš„ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ

4. SQLç¼–å†™è§„åˆ™ï¼š
   - currentã€timestampã€orderç­‰ä¿ç•™å­—å¿…é¡»ä½¿ç”¨åå¼•å·
   - CONCATå‡½æ•°çš„æ‰€æœ‰å‚æ•°å¿…é¡»CASTä¸ºSTRINGç±»åž‹
   - è·¨CatalogæŸ¥è¯¢å¿…é¡»ä½¿ç”¨å®Œæ•´è·¯å¾„

5. æµ‹è¯•ç­–ç•¥è§„åˆ™ï¼š
   - ä½¿ç”¨COUNT()å’ŒLIMITä»£æ›¿å…¨è¡¨æŸ¥è¯¢
   - æµå¼æŸ¥è¯¢å¿…é¡»ä½¿ç”¨timeouté¿å…å¡ä½
   - ä¼˜å…ˆéªŒè¯æ•°æ®é‡ï¼Œå†æŸ¥çœ‹æ ·ä¾‹æ•°æ®

6. é”™è¯¯å¤„ç†è§„åˆ™ï¼š
   - PostgreSQL CDCå¿…é¡»ä½¿ç”¨'decoding.plugin.name' = 'pgoutput'
   - æ¯ä¸ªSQLä¼šè¯éƒ½è¦é‡æ–°åˆ›å»ºfluss_catalog
   - é‡åˆ°å®¹å™¨é‡å¯é—®é¢˜å…ˆæ£€æŸ¥JARåŒ…æŒ‚è½½é…ç½®
   - é‡åˆ°é—®é¢˜å…ˆæŸ¥çœ‹knowledge-base/ç›®å½•çš„è§£å†³æ–¹æ¡ˆ

7. çŸ¥è¯†åº“æ›´æ–°è§„åˆ™ï¼š
   - å‘çŽ°æ–°é—®é¢˜æ—¶å¿…é¡»æ›´æ–°çŸ¥è¯†åº“æ–‡æ¡£
   - è§£å†³é—®é¢˜åŽè¦è®°å½•è¯¦ç»†çš„è§£å†³è¿‡ç¨‹
   - ä¿æŒæ–‡æ¡£çš„æ—¶æ•ˆæ€§å’Œå‡†ç¡®æ€§

è¯·åœ¨æ¯æ¬¡æ“ä½œå‰æ£€æŸ¥è¿™äº›è§„åˆ™ï¼Œç¡®ä¿é¡¹ç›®å¼€å‘çš„ç¨³å®šæ€§å’Œæ•ˆçŽ‡ã€‚
```

---

**ðŸ“ ä½¿ç”¨å»ºè®®ï¼š**
1. å°†æ­¤æ–‡æ¡£ä½œä¸ºAIåŠ©æ‰‹çš„å‚è€ƒåŸºå‡†
2. åœ¨æ–°é¡¹ç›®å¼€å§‹å‰å…ˆç¡®ç«‹è¿™äº›è§„åˆ™
3. é‡åˆ°é—®é¢˜æ—¶å‚è€ƒå¯¹åº”ç« èŠ‚çš„è§£å†³æ–¹æ¡ˆ
4. æ ¹æ®é¡¹ç›®ç‰¹ç‚¹è°ƒæ•´å’Œè¡¥å……è§„åˆ™
5. å®šæœŸæ›´æ–°æœ€ä½³å®žè·µå†…å®¹ 