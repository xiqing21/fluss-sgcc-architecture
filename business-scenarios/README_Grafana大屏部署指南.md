# ğŸ”‹ å›½ç½‘æ™ºèƒ½è°ƒåº¦å¤§å± - Grafanaéƒ¨ç½²æŒ‡å—

## ğŸ“– æ¦‚è¿°

è¿™æ˜¯åŸºäº**Grafana + PostgreSQL + Prometheus**çš„å›½ç½‘æ™ºèƒ½è°ƒåº¦å¤§å±è§£å†³æ–¹æ¡ˆï¼Œä¸“ä¸º**Flussæµæ‰¹ä¸€ä½“æ¶æ„**è®¾è®¡ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **ä¸€é”®éƒ¨ç½²**ï¼šDocker Composeä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
- âœ… **å®æ—¶æ•°æ®**ï¼šç›´æ¥è¿æ¥PostgreSQL sinkè¡¨ï¼Œ5ç§’è‡ªåŠ¨åˆ·æ–°
- âœ… **ä¸“ä¸šå¤§å±**ï¼šé’ˆå¯¹ç”µç½‘ä¸šåŠ¡å®šåˆ¶çš„Dashboard
- âœ… **æµæ‰¹ä¸€ä½“**ï¼šå®Œç¾å±•ç¤ºFlussæ¶æ„ä¼˜åŠ¿
- âœ… **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒè‡ªå®šä¹‰SQLæŸ¥è¯¢å’Œå›¾è¡¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. **Docker** å’Œ **Docker Compose** å·²å®‰è£…
2. **PostgreSQL** æ•°æ®åº“è¿è¡Œåœ¨ç«¯å£ 5442/5443
3. ç¡®ä¿æœ‰ `fluss_sink_table` è¡¨çš„è®¿é—®æƒé™

### ä¸€é”®éƒ¨ç½²

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd fluss-sgcc-architecture

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x business-scenarios/deploy-grafana-stack.sh

# ä¸€é”®éƒ¨ç½²
./business-scenarios/deploy-grafana-stack.sh
```

### è®¿é—®å¤§å±

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ï¼šhttp://localhost:3000

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

## ğŸ“Š å¤§å±åŠŸèƒ½è¯¦è§£

### 1. è®¾å¤‡çŠ¶æ€æ¦‚è§ˆ
- å®æ—¶æ˜¾ç¤ºè®¾å¤‡æ€»æ•°ã€åœ¨çº¿è®¾å¤‡ã€ç¦»çº¿è®¾å¤‡
- è®¡ç®—è®¾å¤‡åœ¨çº¿ç‡

### 2. å®æ—¶è´Ÿè·è¶‹åŠ¿
- æ—¶åºå›¾å±•ç¤ºå¹³å‡è´Ÿè·ç‡ã€æ•ˆç‡è¶‹åŠ¿
- æŒ‰åˆ†é’Ÿèšåˆæ•°æ®

### 3. å®æ—¶è®¾å¤‡ç›‘æ§è¡¨
- è¡¨æ ¼å±•ç¤ºæœ€è¿‘10åˆ†é’Ÿçš„è®¾å¤‡çŠ¶æ€
- æ”¯æŒçŠ¶æ€é¢œè‰²æ˜ å°„ï¼ˆğŸŸ¢åœ¨çº¿ ğŸ”´ç¦»çº¿ ğŸŸ¡ç»´æŠ¤ï¼‰

### 4. è®¾å¤‡ç±»å‹åˆ†å¸ƒ
- é¥¼å›¾å±•ç¤ºä¸åŒè®¾å¤‡ç±»å‹çš„æ•°é‡åˆ†å¸ƒ

### 5. åœ°åŒºè®¾å¤‡åˆ†å¸ƒ
- ç¯å½¢å›¾å±•ç¤ºå„åœ°åŒºè®¾å¤‡åˆ†å¸ƒæƒ…å†µ

### 6. æ ¸å¿ƒæŒ‡æ ‡ä»ªè¡¨ç›˜
- âš¡ ç³»ç»Ÿæ•ˆç‡
- ğŸ“Š è´Ÿè·ç‡  
- ğŸŒ¡ï¸ å¹³å‡æ¸©åº¦
- ğŸš€ Flusså®æ—¶å¤„ç†è®°å½•æ•°

## ğŸ”§ æ•°æ®æºé…ç½®

### PostgreSQL è¿æ¥é…ç½®

æ•°æ®æºå·²è‡ªåŠ¨é…ç½®ï¼Œè¿æ¥ä¿¡æ¯ï¼š

```yaml
Host: host.docker.internal:5442
Database: test_scenario
Username: test_user
Password: test_password
```

### è‡ªå®šä¹‰SQLæŸ¥è¯¢

æ‰€æœ‰Paneléƒ½ä½¿ç”¨SQLæŸ¥è¯¢ï¼Œä½ å¯ä»¥æ ¹æ®å®é™…è¡¨ç»“æ„ä¿®æ”¹ï¼š

```sql
-- ç¤ºä¾‹ï¼šè®¾å¤‡çŠ¶æ€æ¦‚è§ˆ
SELECT 
  COUNT(*) as "è®¾å¤‡æ€»æ•°",
  COUNT(CASE WHEN status = 'online' THEN 1 END) as "åœ¨çº¿è®¾å¤‡",
  COUNT(CASE WHEN status = 'offline' THEN 1 END) as "ç¦»çº¿è®¾å¤‡"
FROM fluss_sink_table 
WHERE $__timeFilter(update_time);
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### PrometheusæŒ‡æ ‡

è®¿é—®ï¼šhttp://localhost:9090

- **PostgreSQLæŒ‡æ ‡**: http://localhost:9187/metrics
- **ç³»ç»ŸæŒ‡æ ‡**: http://localhost:9100/metrics
- **GrafanaæŒ‡æ ‡**: http://localhost:3000/metrics

### å…³é”®æŒ‡æ ‡

1. **æ•°æ®å¤„ç†å»¶è¿Ÿ**ï¼šä»PostgreSQLåˆ°Grafanaçš„ç«¯åˆ°ç«¯å»¶è¿Ÿ
2. **æŸ¥è¯¢æ€§èƒ½**ï¼šSQLæŸ¥è¯¢æ‰§è¡Œæ—¶é—´
3. **ç³»ç»Ÿèµ„æº**ï¼šCPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨ç‡
4. **æ•°æ®åº“è¿æ¥**ï¼šæ´»è·ƒè¿æ¥æ•°ã€è¿æ¥æ± çŠ¶æ€

## ğŸ› ï¸ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ•°æ®åº“è¿æ¥

ç¼–è¾‘ `grafana/provisioning/datasources/datasources.yml`ï¼š

```yaml
datasources:
  - name: PostgreSQL-SGCC
    type: postgres
    url: ä½ çš„æ•°æ®åº“åœ°å€:ç«¯å£
    database: ä½ çš„æ•°æ®åº“å
    user: ä½ çš„ç”¨æˆ·å
    secureJsonData:
      password: ä½ çš„å¯†ç 
```

### æ·»åŠ æ–°çš„Panel

1. ç™»å½•Grafanaï¼ˆhttp://localhost:3000ï¼‰
2. è¿›å…¥ "å›½ç½‘æ™ºèƒ½è°ƒåº¦å¤§å±" Dashboard
3. ç‚¹å‡»å³ä¸Šè§’ "Add Panel"
4. é€‰æ‹© "PostgreSQL-SGCC" æ•°æ®æº
5. ç¼–å†™SQLæŸ¥è¯¢
6. é…ç½®å›¾è¡¨æ ·å¼
7. ä¿å­˜Dashboard

### åˆ›å»ºæ–°çš„Dashboard

1. ç‚¹å‡»å·¦ä¾§èœå• "+"
2. é€‰æ‹© "Dashboard"
3. é…ç½®æ•°æ®æºä¸º "PostgreSQL-SGCC"
4. æŒ‰éœ€æ·»åŠ Panel

## ğŸ”„ å®æ—¶æ•°æ®æµ

### æ•°æ®æµæ¶æ„

```
PostgreSQL CDC â†’ Fluss ODS â†’ Fluss DWD â†’ Fluss DWS â†’ fluss_sink_table â†’ Grafana
```

### åˆ·æ–°é¢‘ç‡

- **Dashboardåˆ·æ–°**: 5ç§’ï¼ˆå¯åœ¨å³ä¸Šè§’ä¿®æ”¹ï¼‰
- **æ•°æ®æ”¶é›†é¢‘ç‡**: 15ç§’ï¼ˆPrometheusé…ç½®ï¼‰
- **æŸ¥è¯¢ç¼“å­˜**: è‡ªåŠ¨ç®¡ç†

## ğŸ¨ ç•Œé¢å®šåˆ¶

### ä¸»é¢˜ä¿®æ”¹

1. è¿›å…¥ Settings â†’ Preferences
2. é€‰æ‹© Dark/Light ä¸»é¢˜
3. è®¾ç½®é»˜è®¤æ—¶åŒº

### é¢œè‰²æ–¹æ¡ˆ

å½“å‰ä½¿ç”¨çš„é¢œè‰²ä¸»é¢˜ï¼š
- ğŸŸ¢ æ­£å¸¸çŠ¶æ€ï¼šç»¿è‰²ç³»
- ğŸŸ¡ è­¦å‘ŠçŠ¶æ€ï¼šé»„è‰²ç³»  
- ğŸ”´ é”™è¯¯çŠ¶æ€ï¼šçº¢è‰²ç³»
- ğŸ”µ ä¿¡æ¯çŠ¶æ€ï¼šè“è‰²ç³»

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…

Dashboardæ”¯æŒå“åº”å¼è®¾è®¡ï¼Œåœ¨æ‰‹æœº/å¹³æ¿ä¸Šä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºã€‚

å»ºè®®ç§»åŠ¨ç«¯è®¿é—®æ—¶ï¼š
1. ä½¿ç”¨æ¨ªå±æ¨¡å¼
2. å¯ç”¨å…¨å±æ¨¡å¼
3. éšè—æµè§ˆå™¨åœ°å€æ 

## ğŸš¨ å‘Šè­¦é…ç½®

### è®¾ç½®å‘Šè­¦è§„åˆ™

1. è¿›å…¥ Alerting â†’ Alert Rules
2. åˆ›å»ºæ–°è§„åˆ™
3. é…ç½®æŸ¥è¯¢æ¡ä»¶ï¼ˆå¦‚è®¾å¤‡ç¦»çº¿ç‡>10%ï¼‰
4. è®¾ç½®é€šçŸ¥æ¸ é“

### é€šçŸ¥æ¸ é“

æ”¯æŒçš„é€šçŸ¥æ–¹å¼ï¼š
- ğŸ“§ é‚®ä»¶é€šçŸ¥
- ğŸ’¬ Slack/ä¼ä¸šå¾®ä¿¡
- ğŸ“± æ‰‹æœºçŸ­ä¿¡
- ğŸŒ Webhook

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•è¿æ¥æ•°æ®åº“**
   ```bash
   # æ£€æŸ¥PostgreSQLæ˜¯å¦è¿è¡Œ
   docker ps | grep postgres
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   telnet localhost 5442
   ```

2. **Dashboardæ˜¾ç¤ºæ— æ•°æ®**
   ```bash
   # æ£€æŸ¥æ•°æ®æºé…ç½®
   curl -u admin:admin123 http://localhost:3000/api/datasources
   # æµ‹è¯•SQLæŸ¥è¯¢
   psql -h localhost -p 5442 -U test_user -d test_scenario
   ```

3. **Grafanaå¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹æ—¥å¿—
   docker logs grafana-sgcc
   # é‡æ–°å¯åŠ¨
   docker restart grafana-sgcc
   ```

### æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**
   ```sql
   -- åˆ›å»ºç´¢å¼•
   CREATE INDEX idx_fluss_sink_table_update_time ON fluss_sink_table(update_time);
   CREATE INDEX idx_fluss_sink_table_status ON fluss_sink_table(status);
   ```

2. **æŸ¥è¯¢ä¼˜åŒ–**
   - ä½¿ç”¨æ—¶é—´èŒƒå›´è¿‡æ»¤
   - é¿å…å…¨è¡¨æ‰«æ
   - åˆç†ä½¿ç”¨èšåˆå‡½æ•°

## ğŸ“š å‚è€ƒèµ„æ–™

- [Grafanaå®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/)
- [PostgreSQLæ•°æ®æºæ–‡æ¡£](https://grafana.com/docs/grafana/latest/datasources/postgres/)
- [Prometheusç›‘æ§æŒ‡æ ‡](https://prometheus.io/docs/)
- [Flusså®˜æ–¹æ–‡æ¡£](https://fluss.apache.org/docs/)

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æ—¥å¿—æ–‡ä»¶**ï¼š`docker logs <container_name>`
2. **ç½‘ç»œè¿é€šæ€§**ï¼šç¡®ä¿å„æœåŠ¡é—´å¯ä»¥æ­£å¸¸é€šä¿¡
3. **é…ç½®æ–‡ä»¶**ï¼šæ£€æŸ¥YAMLé…ç½®è¯­æ³•
4. **èµ„æºä½¿ç”¨**ï¼šç¡®ä¿ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„CPUå’Œå†…å­˜

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ–¹æ¡ˆï¼Œä½ å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„**å›½ç½‘æ™ºèƒ½è°ƒåº¦å¤§å±ç›‘æ§ç³»ç»Ÿ**ï¼š

- âœ… **ä¸“ä¸šçº§å¯è§†åŒ–**ï¼šä¼ä¸šçº§Grafana Dashboard
- âœ… **å®æ—¶æ•°æ®æµ**ï¼šPostgreSQL â†’ Grafana å®æ—¶åŒæ­¥  
- âœ… **æµæ‰¹ä¸€ä½“**ï¼šå®Œç¾å±•ç¤ºFlussæ¶æ„ä¼˜åŠ¿
- âœ… **æ˜“äºæ‰©å±•**ï¼šæ”¯æŒè‡ªå®šä¹‰æŸ¥è¯¢å’Œå›¾è¡¨
- âœ… **ä¸€é”®éƒ¨ç½²**ï¼šDockeråŒ–éƒ¨ç½²ï¼Œè¿ç»´ç®€å•

ç›¸æ¯”è‡ªå·±å¼€å‘HTMLå¤§å±ï¼ŒGrafanaæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **å¼€å‘æ•ˆç‡**ï¼šæ— éœ€ç¼–å†™å‰ç«¯ä»£ç ï¼Œæ‹–æ‹½é…ç½®
2. **ç¨³å®šå¯é **ï¼šç»è¿‡å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒéªŒè¯
3. **åŠŸèƒ½ä¸°å¯Œ**ï¼šå†…ç½®å‘Šè­¦ã€ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶
4. **ç¤¾åŒºæ”¯æŒ**ï¼šä¸°å¯Œçš„æ’ä»¶å’Œæ¨¡æ¿åº“
5. **æŒç»­æ›´æ–°**ï¼šå®˜æ–¹æŒç»­ç»´æŠ¤å‡çº§

ğŸš€ **Fluss + Grafana = å®Œç¾çš„æµæ‰¹ä¸€ä½“ç›‘æ§è§£å†³æ–¹æ¡ˆï¼** 